<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                template="./echomarketTemplate.xhtml"         >
  <ui:define name="header"  >
    <ui:include rendered="true" src="application_header.xhtml" id="communityHeader" /> 
  </ui:define>

  <ui:define name="content">

    <h:head>
      <h:outputScript library="javascript" name="community.js"  />`
      <h:outputStylesheet library="css" name="member.css"/>
      <title>#{bundle.communityMemberTitle}</title>
    </h:head>

    <ui:include rendered="true" src="dumbyDiv.xhtml" id="dumbyDiv" /> 

    <div  id="form_community_members">

      <h:form id="member_build" >
        <div class="message.color">
          <h:messages showSummary="true" 
                      showDetail="false"
                      errorStyle="color: #d20005" 
                      infoStyle="color: indigo"/>
        </div>
        <div >
          <div style="margin:10px;margin-top:25px;" >
            <h:outputText value="#{userBean.communityName} : Community Members" style="color:black;font-weight:bold;"/>
          </div>    
          <div style="float:left;margin:15px;margin-top:10px;" >
            <h:outputText value="View, Update, or Add Members..." style="color:black;font-weight:bold;"/>
            <br /><br />
            <c:if test="#{communityMembersBean.editable != 3}" >
              <h:outputText value="To add, please entered the number of New Members and then click 'Add Member'..." style="color:indigo;font-weight:normal;"/>
              <br />
              <h:outputText value="Members with the same first name, last name and alias are considered duplicates. Distinguish a parent and child with the same name by their alias" style="color:indigo;font-weight:normal;"/>
              <br />
              <h:outputLabel for="howManyRecords" value="Number of new members? Please enter a value between 1 and 25." style="color:crimson;font-weight:normal;" >
                <h:inputText id="howManyRecords"  value="#{communityMembersBean.howManyRecords}"  style="margin-left:5px;" maxlength="2" >
                </h:inputText>   
              </h:outputLabel>
              <span class="error-message" id="howManyRecords" ></span>
              <br />
              <h:commandLink value="Add Member" action="#{communityMembersBean.addAction()}"  style="margin-left:15px;"/>    
            </c:if>
            <c:if test="#{communityMembersBean.editable == 3}" >
              <h:outputText value="Adding Member...Each field is required." />
              <br />
              <h:outputText value="Incomplete rows will be ignored." />    
              <h:commandLink value="Save New Member(s)" action="#{communityMembersBean.saveAction()}" style="margin-left: 5px;" />    
            </c:if>
          </div> 
        </div> 

        <h:dataTable value="#{communityMembersBean.buildCommunityMemberCreators()}" id="creator" var="creator" 

                     styleClass="member-table"
                     headerClass="member-table-header"
                     rowClasses="member-table-odd-row,member-table-even-row"
                     >

           <f:facet name="header">
                    <h:outputText value="Designated Community Creators" />
                </f:facet>

          <h:column >
            <f:facet name="header" >First Name</f:facet>
            <h:outputText value="#{creator.firstName}"  />


          </h:column>
          <h:column>
            <f:facet name="header">Last Name</f:facet>
            <h:outputText value="#{creator.lastName}"  />


          </h:column>
          <h:column>
            <f:facet name="header">Alias</f:facet>
            <h:outputText value="#{creator.alias}"  />

          </h:column>
          <h:column>
            <f:facet name="header">Email</f:facet>
            <h:outputText value="#{creator.emailAlternative}"  />

          </h:column>

          <h:column>
            <f:facet name="header">Is Active?</f:facet>
            <h:outputText value="Yes" style="color: green; font-weight: bold;" rendered="#{creator.isActive == 1}"/>
            <h:outputText value="No" style="color: crimson; font-weight: bold;" rendered="#{creator.isActive == 0}"/>

          </h:column>
        </h:dataTable>

        <h:dataTable value="#{communityMembersBean.buildCommunityMembersList()}" id="member" var="member" 

                     styleClass="member-table"
                     headerClass="member-table-header"
                     rowClasses="member-table-odd-row,member-table-even-row"
                     rendered="#{communityMembersBean.editable != 3}"

                     >
           <f:facet name="header">
                    <h:outputText value="Community Members" />
             </f:facet>


          <h:column >
            <f:facet name="header" >First Name</f:facet>
            <h:outputText value="#{member.firstName}" rendered="#{member.editable == 0}" />
            <h:inputText id="update_first_Name" value="#{communityMembersBean.firstName}" rendered="#{member.editable == 1}" />
          </h:column>
          <h:column>
            <f:facet name="header">Last Name</f:facet>
            <h:outputText value="#{member.lastName}" rendered="#{member.editable == 0}" />
            <h:inputText value="#{member.lastName}" rendered="#{member.editable == 1}" />

          </h:column>
          <h:column>
            <f:facet name="header">Alias</f:facet>
            <h:outputText value="#{member.alias}" rendered="#{member.editable == 0}" />
            <h:inputText value="#{member.alias}" rendered="#{member.editable == 1}" />
          </h:column>
          <h:column>
            <f:facet name="header">Email</f:facet>
            <h:outputText value="#{member.emailAlternative}" rendered="#{member.editable == 0}" />
            <h:inputText value="#{member.emailAlternative}" rendered="#{member.editable == 1}" 
                         size="16"
                         required="true"
                         requiredMessage="#{bundle.ReqEmail}"
                         validatorMessage="#{bundle.ValidEmail}" 
                         >
              <f:validateRegex
                pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
            </h:inputText>
          </h:column>
          <h:column>
            <f:facet name="header">Is Active?</f:facet>
            <h:outputText value="Yes" style="color: green; font-weight: bold;" rendered="#{(member.isActive == 1) and (member.editable == 0)}" />
            <h:outputText value="No" style="color: red; font-weight: bold;" rendered="#{(member.isActive == 0)  and (member.editable == 0)}" />

            <h:selectOneRadio id="isActive" value="#{member.isActive}" layout="pageDirection" rendered="#{member.editable == 1}"  >
              <f:selectItem itemValue="1" itemLabel="Yes?" />
              <f:selectItem itemValue="0" itemLabel="No?" />	
            </h:selectOneRadio>    

          </h:column>

          <h:column>
            <f:facet name="header">Is Creator?</f:facet>
            <h:outputText value="Yes" style="color: green; font-weight: bold;" rendered="#{(member.isCreator == 1) and (member.editable == 0)}" />
            <h:outputText value="No" style="color: red; font-weight: bold;" rendered="#{(member.isCreator == 0)  and (member.editable == 0)}" />

            <h:selectOneRadio id="isCreator" value="#{member.isCreator}" layout="pageDirection" rendered="#{member.editable == 1}"  >
              <f:selectItem itemValue="1" itemLabel="Yes?" />
              <f:selectItem itemValue="0" itemLabel="No?" />	
            </h:selectOneRadio>    

          </h:column>

          <h:column>
            <f:facet name="header">Completed Registration?</f:facet>
            <h:outputText value="Yes" style="color: green; font-weight: bold;" rendered="#{(member.goodwill == 1)  and (member.age18OrMore == 1)}" />
            <h:outputText value="No" style="color: red; font-weight: bold;" rendered="#{(member.goodwill == 0)  and (member.age18OrMore == 0)}" />
          </h:column>

          <h:column>
            <f:facet name="header">Date Created</f:facet>
            <!--  Eventually want to sort by date created, or toggle between date created, date updated.<h:commandLink value="#{member.dateCreated}" action="" style="color: green; font-weight: lighter;" />-->
            <h:outputText value="#{member.dateCreated}" style="color: green; font-weight: lighter;" />                       

          </h:column>


          <h:column>
            <f:facet name="header">Action</f:facet>
            <h:commandLink value="Edit" action="#{communityMembersBean.editAction(member)}" rendered="#{member.editable == 0}" />
            <h:commandLink value="Update" action="#{communityMembersBean.updateAction()}" rendered="#{member.editable == 1}" />
            <h:outputText value=" | " style="color: green; font-weight: lighter;" rendered="#{member.editable == 1}" />
            <h:commandLink value="Cancel" action="#{communityMembersBean.cancelAction(member)}" rendered="#{member.editable == 1}" />
            <br />


          </h:column>
        </h:dataTable>

        <h:dataTable value="#{communityMembersBean.existing_member}" id="new_rows" var="new" 
                     styleClass="member-table"
                     headerClass="member-table-header"
                     rowClasses="member-table-odd-row,member-table-even-row"
                     style="margin: 25px;"
                     rendered="#{communityMembersBean.editable == 3}" 
                     >

           <f:facet name="header">
                    <h:outputText value="New Community Members" />
                </f:facet>
          <h:column >
            <f:facet name="header" >First Name</f:facet>
            <h:inputText id="firstName" value="#{new.firstName}"  />

          </h:column>
          <h:column>
            <f:facet name="header">Last Name</f:facet>
            <h:inputText id="lastName"  value="#{new.lastName}" />

          </h:column>
          <h:column>
            <f:facet name="header">Alias</f:facet>
            <h:inputText id="alias"   value="#{new.alias}"  />
          </h:column>
          <h:column>
            <f:facet name="header">Notification Email</f:facet>
            <h:inputText id="email"  
                         size="16"
                         value="#{new.emailAlternative}"
                         >

            </h:inputText>
            <br />
            <span class="error-message" id="email#{new.rowIndex}}" ></span>
          </h:column>
          <h:column>
            <f:facet name="header">Is Active?</f:facet>
            <h:selectOneRadio id="isActive" value="#{new.isActive}" layout="pageDirection" >
              <f:selectItem itemValue="1" itemLabel="Yes?" />
              <f:selectItem itemValue="0" itemLabel="No?" />	
            </h:selectOneRadio>    
          </h:column>
          <h:column>
            <f:facet name="header">Creator Privilege?</f:facet>
            <h:selectOneRadio id="isCreator" value="#{new.isCreator}" layout="pageDirection" >
              <f:selectItem itemValue="1" itemLabel="Yes?" />
              <f:selectItem itemValue="0" itemLabel="No?" />	
            </h:selectOneRadio>    
          </h:column>
        </h:dataTable>

      </h:form>
    </div>


  </ui:define>

  <ui:define name="footer"  >
    <ui:include rendered="true" src="application_footer.xhtml" id="CommunityMemberFooter" /> 
  </ui:define>

</ui:composition>
